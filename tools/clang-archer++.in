#!/bin/bash

linking=yes
for arg in "$@" ; do
  case "$arg" in
  -c|-S|-E|-M|-MM|MMD)
    linking=no
  ;;
  esac
done

if [ $linking == yes ] ; then
    if [ @LIBOMP_TSAN_SUPPORT@ == FALSE ] ; then
  	link_flags="-L@OMP_PREFIX@/lib -Wl,-rpath=@OMP_PREFIX@/lib -L@CMAKE_INSTALL_PREFIX@/lib -Wl,-rpath=@CMAKE_INSTALL_PREFIX@/lib -larcher"
    else
  	link_flags="-L@OMP_PREFIX@/lib -Wl,-rpath=@OMP_PREFIX@/lib"
    fi
else
  link_flags=""
fi

@LLVM_ROOT@/bin/clang++ -I@OMP_PREFIX@/include -Xclang -load -Xclang @CMAKE_INSTALL_PREFIX@/lib/LLVMArcher.so -fopenmp -fsanitize=thread $link_flags -g "$@"
